# Мастерская - 2. Мэтчинг товаров.

## Отчёт по исследованию

1. Заказчик предоставил данные в 4 файлах:
    - `base.csv` - анонимизированный набор товаров. Каждый товар представлен как уникальный id (0-base, 1-base, 2-base) и вектор признаков размерностью 72.
    - `train.csv` - обучающий датасет. Каждая строчка - один товар, для которого известен уникальный id (0-query, 1-query, …), вектор признаков И id товара из base.csv, который максимально похож на него (по мнению экспертов).
    - `validation.csv` - датасет с товарами (уникальный id и вектор признаков), для которых надо найти наиболее близкие товары из base.csv
    - `validation_answer.csv` - правильные ответы к предыдущему файлу 'validation.csv'.
    Каждый объект множества описывается какими-то анонимизированными признаками.
<br><br>

2. Были поставлены задачи:
    - разработать алгоритм, который для всех товаров из множества A предложит несколько вариантов наиболее похожих товаров из множества B;
    - оценить качество алгоритма по метрике accuracy@5:<br><br>
        $accuracy@5 = 100 * \frac{n}{5}$,<br><br>
        где n - количество верно определённых похожих объектов из 5 возможных.
<br><br>

3. Выполнена загрузка файлов, все значения корректно распределены по столбцам:
    - `df_base` состоит из 291 813 строк и 73 столбцов, не имеет пропусков, все колонки кроме id типа float64.
    - `df_train` состоит из 9 999 строк и 74 столбцов, не имеет пропусков, все колонки кроме id и target типа float64.
    - `df_validation` состоит из 10 000 строк и 73 столбцов, не имеет пропусков, все колонки кроме id типа float64.
    - `df_validation_answer` состоит из 10 000 строк и 2 столбцов, не имеет пропусков, все колонки типа object.
<br><br>

4. В процессе предобработки данных:
    - наименования колонок не требовали преобразования;
    - пропусков не обнаружено;
    - исправлены типы данных;
    - обнаружены и исключены явные дубликаты;
    - неявные дубликаты или аномалии отсутствуют;
    - добавление новых столбцов не потребовалось.
<br><br>

5. Предобработка не потребовала значительного удаления информации, потому более 96% данных представлено к дальнейшему анализу.
<br><br>

6. Результаты исследовательского анализа данных:
    - подавляющее большинство признаков (89%) имеют нормальное распределение;
    - признак `6` распределён практически равномерно, видны 2 моды;
    - признаки `21` и `25` - практически константа с модой в значениях 1500 и 800, соответственно. Исключим их из датасета;
    - признак `33` имеет мультимодальное распределение;
    - признак `44` распределён практически равномерно с пиком в значении около -65;
    - признаки `59` и `65` имеют равномерное распределение;
    - признак `70` - также практически константа с модой в значении -1100. Исключим его из всех датафреймов;
    - попарное визуальное сравнение признаков для датафреймов [df_base <> df_train] и [df_train <>> df_validation] показали, что распределния данных в каждой колонке практически идентично. Тренировочная и валидационная выборки репрезентативно представлены;
    - матрицы корреляций для 3 датасетов не показали столбцов с мультиколинеарностью;
    - признак 63 имеет более тесную связь с другими столбцами, но эта связь преимущественно ниже 0.5.
<br><br>

7. Осуществлена подготвка датафреймов: данные масштабированы и нормализованы.
<br><br>

8. Проведён поиск похожих товаров без кластеризации датафрейма df_base с помощью алгоритма kNN и метода NearestNeighbors.<br>
Верно определно 70% товаров для датасета df_train с применением расстояния Manhattan за 28 секунд.
<br><br>

9. Выполнен анализ датафрейма df_base на возможность разбиения его на кластеры. рассматривались методы KMeans, DBSCAN и AgglomerativeClustering. Для оценки результатов применялись метод локтя, метод силуэта и индекс Дэвиса-Боулдина. Все три метода кластеризации не выявили однозначно рекомендуемого количества делений датафрейма на кластеры. Данные однородны и равномерно распространены по n-мерному пространству признаков.
<br><br>

10. Несмотря на выводы из анализа кластеризации, осуществлён мэтчинг товаров с разбиением на 5 кластеров. Скорость выполнения подбора значительно сократилась, но метрика accuracy составляет 0%.
<br><br>

11. Выполнен поиск похожих товаров с помощью алгоритма FAISS с индексом IVF (Inverted File). Он показал лучшую метрику Accuracy@5 при делении данных df_base на 5 кластерах и поиске в 4 ближайщих к лучшему центройду кластерах. Метрика составила 76,2% и рассчитана за 20 секунд.